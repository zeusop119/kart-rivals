<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KART RIVALS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
:root {
  --accent: #ffcc00;
  --danger: #ff4444;
  --success: #00ff88;
  --glass: rgba(0,0,0,0.55);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #2a2a2a, #000);
  font-family: "Segoe UI", Arial, sans-serif;
  color: white;
  overflow: hidden;
  touch-action: manipulation;
}

/* SAFE MOBILE SCALING */
.game-container {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.game-scale {
  transform-origin: center center;
}

canvas {
  display: block;
  background: linear-gradient(#2c2c2c, #1a1a1a);
  border-radius: 16px;
  box-shadow: 0 30px 80px rgba(0,0,0,0.8);
}

/* HUD */
.hud {
  position: absolute;
  top: 20px;
  left: 20px;
  padding: 16px 20px;
  background: var(--glass);
  backdrop-filter: blur(14px);
  border-radius: 18px;
  font-weight: 600;
  line-height: 1.6;
  z-index: 5;
}

.hud span {
  color: var(--accent);
  font-weight: 800;
}

.center {
  position: absolute;
  width: 100%;
  text-align: center;
  top: 45%;
  font-size: 64px;
  font-weight: 900;
  display: none;
  text-shadow: 0 0 30px rgba(0,0,0,0.9);
  z-index: 6;
}

.overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(rgba(0,0,0,0.88), rgba(0,0,0,0.96));
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10;
  text-align: center;
}

.title {
  font-size: 72px;
  font-weight: 900;
  color: var(--accent);
}

.subtitle {
  opacity: 0.85;
  margin: 16px 0 36px;
  font-size: 18px;
}

button {
  padding: 18px 54px;
  font-size: 20px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, #ffcc00, #ff8800);
  color: black;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 15px 50px rgba(255,200,0,0.5);
}

.win-score {
  font-size: 28px;
  margin-top: 18px;
  color: var(--success);
}
</style>
</head>
<body>

<!-- START SCREEN -->
<div class="overlay" id="startScreen">
  <div class="title">KART RIVALS</div>
  <div class="subtitle">Precision Racing Challenge</div>
  <button onclick="startGame()">START RACE</button>
</div>

<!-- WIN SCREEN -->
<div class="overlay" id="winScreen" style="display:none;">
  <div class="title">üèÜ WINNER</div>
  <div class="win-score">FINAL SCORE: <span id="finalScore">0</span></div>
  <button onclick="location.reload()" style="margin-top:40px;">PLAY AGAIN</button>
</div>

<!-- HUD -->
<div class="hud">
  ‚ù§Ô∏è Lives: <span id="lives">10</span><br>
  ‚≠ê Score: <span id="score">0</span><br>
  üî• Combo: <span id="streak">1x</span>
</div>

<div class="center" id="result"></div>

<div class="game-container">
  <div class="game-scale" id="gameScale">
    <canvas id="game" width="900" height="400"></canvas>
  </div>
</div>

<!-- AUDIO -->
<audio id="engine" src="engine.mp3" loop></audio>
<audio id="click" src="click.mp3"></audio>
<audio id="winSound" src="win.mp3"></audio>

<script>
/* SAFE SCALING */
const scaleEl = document.getElementById("gameScale");
function updateScale() {
  const scale = Math.min(
    window.innerWidth / 900,
    window.innerHeight / 400
  );
  scaleEl.style.transform = `scale(${scale})`;
}
window.addEventListener("resize", updateScale);
updateScale();

/* GAME */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const kartImg = new Image();
kartImg.src = "kart.png";

const silhouetteImg = new Image();
silhouetteImg.src = "silhouette.png";

const engine = document.getElementById("engine");
const clickSound = document.getElementById("click");
const winSound = document.getElementById("winSound");

engine.volume = 0.35;
winSound.volume = 0.6;

let running = false;
let finished = false;

let kart = { x:-300, y:230, speed:4, width:260, height:90 };
const targetX = 520;

let lives = 10;
let score = 0;
let streak = 1;

let shakeTime = 0;
let speedLines = Array.from({ length: 40 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  len: Math.random() * 40 + 20
}));

let lastTime = performance.now();

function startGame() {
  startScreen.style.display = "none";
  running = true;
  engine.play();
}

function resetKart() { kart.x = -300; }

function update(delta = 1) {
  if (!running || finished) return;

  kart.x += kart.speed * delta;
  if (kart.x > canvas.width + 50) miss();

  speedLines.forEach(l => {
    l.x -= kart.speed * 3 * delta;
    if (l.x < -l.len) l.x = canvas.width + Math.random() * 200;
  });

  if (shakeTime > 0) shakeTime -= delta;
}

function draw() {
  ctx.save();

  if (shakeTime > 0)
    ctx.translate((Math.random()-0.5)*10,(Math.random()-0.5)*10);

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#555";
  ctx.fillRect(0,260,canvas.width,80);

  ctx.globalAlpha=0.6;
  ctx.drawImage(silhouetteImg,targetX,kart.y,kart.width,kart.height);
  ctx.globalAlpha=1;

  ctx.drawImage(kartImg,kart.x-10,kart.y,kart.width,kart.height);
  ctx.drawImage(kartImg,kart.x,kart.y,kart.width,kart.height);

  ctx.restore();
}

function checkClick(e) {
  e.preventDefault();
  if (!running || finished) return;

  clickSound.play();
  const diff = Math.abs(kart.x - targetX);

  if (diff < 10) {
    score += 2 * streak;
    streak++;
    kart.speed += 0.6;
    shakeTime = 15;
    showText(`PERFECT x${streak}`, "var(--success)");
  } else if (diff < 30) {
    score += 1 * streak;
    streak++;
    kart.speed += 0.3;
    showText(`GOOD x${streak}`, "var(--accent)");
  } else {
    miss(); return;
  }

  updateHUD();
  resetKart();
  if (score >= 15) win();
}

function miss() {
  lives--;
  streak = 1;
  showText("MISS!", "var(--danger)");
  resetKart();
  updateHUD();
  if (lives <= 0) gameOver();
}

function updateHUD() {
  livesEl.textContent = lives;
  scoreEl.textContent = score;
  streakEl.textContent = streak + "x";
}

function showText(text, color) {
  result.style.color = color;
  result.textContent = text;
  result.style.display = "block";
  setTimeout(() => result.style.display="none",700);
}

function win() {
  finished = true;
  engine.pause();
  winSound.currentTime = 0;
  winSound.play();
  finalScore.textContent = score;
  winScreen.style.display = "flex";
}

function gameOver() {
  finished = true;
  engine.pause();
  alert("üíÄ GAME OVER\nScore: " + score);
  location.reload();
}

const livesEl = document.getElementById("lives");
const scoreEl = document.getElementById("score");
const streakEl = document.getElementById("streak");
const result = document.getElementById("result");
const winScreen = document.getElementById("winScreen");
const finalScore = document.getElementById("finalScore");

/* SINGLE INPUT SYSTEM ‚Äî NO DOUBLE TAP */
canvas.addEventListener("pointerdown", checkClick);

function loop(time) {
  const delta = (time - lastTime) / 16.67;
  lastTime = time;
  update(delta);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>
